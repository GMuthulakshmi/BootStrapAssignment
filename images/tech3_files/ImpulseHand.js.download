var campaignName;var quartileMarked={expand:{first:false,second:false,third:false,last:false,zero:false},collapse:{first:false,second:false,third:false,last:false,zero:false},first:false,second:false,third:false,last:false,zero:false};var icon_unmute="http://delivery.forkcdn.com/impulse/video_control_icons/unmute.png";var icon_mute="http://delivery.forkcdn.com/impulse/video_control_icons/mute.png";var icon_play="http://delivery.forkcdn.com/impulse/video_control_icons/play.png";var icon_pause="http://delivery.forkcdn.com/impulse/video_control_icons/pause.png";var videoControls=[{action:"play",image:icon_play,display:"block"},{action:"pause",image:icon_pause,display:"none"},{action:"mute",image:icon_unmute,display:"block"},{action:"unmute",image:icon_mute,display:"none"}];var videoObjID;var videoUrl;var videoObj;var secondaryvideoObj;var videoObjInterval=null;var YTvideoObjInterval=null;var YTSecondaryVideoObjInterval=null;var bannerSize=null;var YTvideo;var YTvideoSecondary=null;var customPlayer=null;var customPlayerSecondary=null;var customFlag=false;var controlsAdded=false;var secondaryControlsAdded=false;function ImpulseHandShake(e){console.log("starts");if(e.bannerSize!=null||e.bannerSize!=""||e.bannerSize!=undefined){bannerSize=e.bannerSize}else{bannerSize="Not Given"}if(e.campaignName!=null){campaignName=e.campaignName}if(e.videoObj.videoObjId!=null&&e.videoObj.videoObjId!=""&&!customFlag){videoObjID=e.videoObj.videoObjId;videoUrl=e.videoObj.url;videoObj=document.querySelector("#"+videoObjID);addSourceToExpandoVideo(videoObj,videoUrl,false);videoObj.load();console.log(videoObjID);if(!controlsAdded&&e.videoContainer&&typeof e.videoContainer!="undefined"){addControls(e.videoContainer)}customFlag=true;videoObj.addEventListener("playing",function(){console.log("adding event");wireVideoObject("primary")});videoObj.addEventListener("pause",function(){})}if(typeof e.secondaryvideoObj==="undefined"){e.secondaryvideoObj=null}if(e.secondaryvideoObj!=null){videoObjID=e.secondaryvideoObj.videoObjId;videoUrl=e.secondaryvideoObj.url;secondaryvideoObj=document.querySelector("#"+videoObjID);addSourceToExpandoVideo(secondaryvideoObj,videoUrl,true);secondaryvideoObj.load();console.log(videoObjID);if(!secondaryControlsAdded&&e.secondaryVideoContainer&&typeof e.secondaryVideoContainer!="undefined"){addControls(e.secondaryVideoContainer,true)}secondaryvideoObj.addEventListener("playing",function(){wireVideoObject("secondary")});secondaryvideoObj.addEventListener("pause",function(){})}if(e.YTvideo.videoObj!=null&&e.YTvideo.isYT){YTvideo=e.YTvideo;if(e.YTvideoSecondary.videoObj!=null&&e.YTvideoSecondary.isYT){YTvideoSecondary=e.YTvideoSecondary}console.log(YTvideo,YTvideoSecondary);createYTObject();if(e.videoContainer&&typeof e.videoContainer!="undefined"&&!controlsAdded){addControls(e.videoContainer)}}}function addControls(e,a){var r=document.querySelector("#"+e);var o=window.getComputedStyle(r);var n=o.left;var t=o.top;var i=o.width;var l=o.height;videoControls.forEach(function(e){var o=document.createElement("img");o.src=e.image;o.height="25";o.width="25";o.style.position="absolute";o.style.top=parseInt(l)-25+"px";o.style.display=e.display;if(e.action=="play"||e.action=="pause"){o.style.left="0px"}else{o.style.left="25px"}if(a){o.id=e.action+"_btnSecondary";o.addEventListener("click",function(){wirePlaybackItemsSecondary(e.action)})}else{o.id=e.action+"_btn";o.addEventListener("click",function(){wirePlaybackItems(e.action)})}r.appendChild(o)});if(a){secondaryControlsAdded=true}else{controlsAdded=true}}function wirePlaybackItems(e){if(e==="play"){playVideo()}if(e==="pause"){pauseVideo()}if(e==="mute"){console.log("muting");muteVideo()}if(e==="unmute"){unmuteVideo()}}function wirePlaybackItemsSecondary(e){if(e==="play"){playVideoSecondary()}if(e==="pause"){pauseVideoSecondary()}if(e==="mute"){console.log("muting");muteVideoSecondary()}if(e==="unmute"){unmuteVideoSecondary()}}function createYTObject(e){var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(a,r)}var player=null;var playerSecondary=null;function onYouTubeIframeAPIReady(e){if(typeof YTvideo.controls!="undefined"){var a=YTvideo.controls}player=new YT.Player(YTvideo.videoObj,{videoId:YTvideo.id,playerVars:{controls:a},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}});if(YTvideoSecondary!=null){if(YTvideoSecondary.isYT){console.log("second",YTvideoSecondary);if(typeof YTvideoSecondary.controls!="undefined"){var a=YTvideoSecondary.controls}playerSecondary=new YT.Player(YTvideoSecondary.videoObj,{videoId:YTvideoSecondary.id,playerVars:{controls:a},events:{onReady:onSecondaryPlayerReady,onStateChange:onSecondaryPlayerStateChange}})}}}function onPlayerReady(e){YTvideo.duration=player.getDuration();YTvideo.initFunction(player);if(YTvideo.autoplay){e.target.playVideo()}}function onPlayerStateChange(e){YTvideo.onChangeFunction(player);if(e.data==YT.PlayerState.PLAYING){wireYouTubeObject("primary");playbackControl("play")}else if(e.data==YT.PlayerState.PAUSED||e.data==YT.PlayerState.ENDED)playbackControl("pause")}function onSecondaryPlayerReady(e){console.log("secondary");YTvideoSecondary.duration=playerSecondary.getDuration();YTvideoSecondary.initFunction(playerSecondary);if(YTvideoSecondary.autoplay){e.target.playVideo()}}function onSecondaryPlayerStateChange(e){YTvideoSecondary.onChangeFunction(playerSecondary);if(e.data==YT.PlayerState.PLAYING){wireSecondaryYouTubeObject("secondary")}}function playbackControl(e){if(e==="play"){document.querySelector("#pause_btn").style.display="block";document.querySelector("#play_btn").style.display="none"}else{document.querySelector("#pause_btn").style.display="none";document.querySelector("#play_btn").style.display="block"}}function volumeControl(e){if(e==="mute"){document.querySelector("#unmute_btn").style.display="block";document.querySelector("#mute_btn").style.display="none"}else{document.querySelector("#unmute_btn").style.display="none";document.querySelector("#mute_btn").style.display="block"}}function playbackControlSecondary(e){if(e==="play"){document.querySelector("#pause_btnSecondary").style.display="block";document.querySelector("#play_btnSecondary").style.display="none"}else{document.querySelector("#pause_btnSecondary").style.display="none";document.querySelector("#play_btnSecondary").style.display="block"}}function volumeControlSecondary(e){if(e==="mute"){document.querySelector("#unmute_btnSecondary").style.display="block";document.querySelector("#mute_btnSecondary").style.display="none"}else{document.querySelector("#unmute_btnSecondary").style.display="none";document.querySelector("#mute_btnSecondary").style.display="block"}}function playVideo(){playbackControl("play");if(player){player.playVideo()}if(customPlayer!=null){customPlayer.play()}}function pauseVideo(){playbackControl("pause");if(player!=null){player.pauseVideo()}if(customPlayer!=null){customPlayer.pause()}}function muteVideo(){volumeControl("mute");if(player){player.mute()}if(customPlayer!=null){customPlayer.muted=true}}function unmuteVideo(){volumeControl("unmute");if(player){player.unMute()}if(customPlayer!=null){customPlayer.muted=false}}function playVideoSecondary(){playbackControlSecondary("play");if(playerSecondary!=null){playerSecondary.playVideo()}if(customPlayerSecondary!=null){customPlayerSecondary.play()}}function pauseVideoSecondary(){playbackControlSecondary("pause");if(playerSecondary!=null){playerSecondary.pauseVideo()}if(customPlayerSecondary!=null){customPlayerSecondary.pause()}}function muteVideoSecondary(){volumeControlSecondary("mute");if(playerSecondary!=null){playerSecondary.mute()}if(customPlayerSecondary!=null){customPlayerSecondary.muted=true}}function unmuteVideoSecondary(){volumeControlSecondary("unmute");if(playerSecondary!=null){playerSecondary.unMute()}if(customPlayerSecondary!=null){customPlayerSecondary.muted=false}}function wireVideoObject(e){if(videoObjInterval==null){videoObjInterval=setInterval(function(){if(videoObj.currentTime>=15){if(quartileMarked.zero==false){quartileMarked.zero=true;quartileMarking(0,e)}}if(videoObj.currentTime==videoObj.duration){if(quartileMarked.last==false){quartileMarked.last=true;quartileMarking(4,e)}setTimeout(function(){clearInterval(videoObjInterval)},500)}else if(videoObj.currentTime>=videoObj.duration*.25&&videoObj.currentTime<videoObj.duration*.5){if(quartileMarked.first==false){quartileMarked.first=true;quartileMarking(1,e)}}else if(videoObj.currentTime>=videoObj.duration*.5&&videoObj.currentTime<videoObj.duration*.75){if(quartileMarked.second==false){quartileMarked.second=true;quartileMarking(2,e)}}else if(videoObj.currentTime>=videoObj.duration*.75&&videoObj.currentTime<videoObj.duration){if(quartileMarked.third==false){quartileMarked.third=true;quartileMarking(3,e)}}},300)}else{}}function wireYouTubeObject(e){if(YTvideoObjInterval==null){YTvideoObjInterval=setInterval(function(){if(player&&typeof player!="undefined"){if(player.getCurrentTime()>=5){if(quartileMarked.zero==false){quartileMarked.zero=true;quartileMarking(0,e)}}if(player.getCurrentTime()==player.getDuration()){if(quartileMarked.last==false){quartileMarked.last=true;quartileMarking(4,e)}setTimeout(function(){clearInterval(YTvideoObjInterval)},500)}else if(player.getCurrentTime()>=player.getDuration()*.25&&player.getCurrentTime()<player.getDuration()*.5){if(quartileMarked.first==false){quartileMarked.first=true;quartileMarking(1,e)}}else if(player.getCurrentTime()>=player.getDuration()*.5&&player.getCurrentTime()<player.getDuration()*.75){if(quartileMarked.second==false){quartileMarked.second=true;quartileMarking(2,e)}}else if(player.getCurrentTime()>=player.getDuration()*.75&&player.getCurrentTime()<player.getDuration()){if(quartileMarked.third==false){quartileMarked.third=true;quartileMarking(3,e)}}}},300)}else{}}function wireSecondaryYouTubeObject(e){if(YTSecondaryVideoObjInterval==null){YTSecondaryVideoObjInterval=setInterval(function(){if(playerSecondary&&typeof playerSecondary!="undefined"){if(playerSecondary.getCurrentTime()>=5){if(quartileMarked.zero==false){quartileMarked.zero=true;quartileMarking(0,e)}}if(playerSecondary.getCurrentTime()==playerSecondary.getDuration()){if(quartileMarked.last==false){quartileMarked.last=true;quartileMarking(4,e)}setTimeout(function(){clearInterval(YTSecondaryVideoObjInterval)},500)}else if(playerSecondary.getCurrentTime()>=playerSecondary.getDuration()*.25&&playerSecondary.getCurrentTime()<playerSecondary.getDuration()*.5){if(quartileMarked.first==false){quartileMarked.first=true;quartileMarking(1,e)}}else if(playerSecondary.getCurrentTime()>=playerSecondary.getDuration()*.5&&playerSecondary.getCurrentTime()<playerSecondary.getDuration()*.75){if(quartileMarked.second==false){quartileMarked.second=true;quartileMarking(2,e)}}else if(playerSecondary.getCurrentTime()>=playerSecondary.getDuration()*.75&&playerSecondary.getCurrentTime()<playerSecondary.getDuration()){if(quartileMarked.third==false){quartileMarked.third=true;quartileMarking(3,e)}}}},300)}else{}}function initiateVideoLoad(){window.parent.postMessage({source:"ImpulseVideoStart",campaignName:campaignName},"*")}function quartileMarking(e,a){var r=null;var o=null;if(!a||a===null||typeof a==="undefined"){var a="primary"}switch(e){case 0:r="VideoView";break;case 1:r="FirstQuartile";break;case 2:r="SecondQuartile";break;case 3:r="ThirdQuartile";break;case 4:r="FinalQuartile";break}console.log("quartileMarking:"+e+" quartile:"+r);window.parent.postMessage({source:"ImpulseQuartileMarking",quartile:r,campaignName:campaignName,bannerSize:bannerSize,videoInfo:a},"*")}function addSourceToExpandoVideo(e,a,r){if(e.childNodes.length===0){var o=document.createElement("source");o.type="video/mp4";o.src=a.mp4;e.appendChild(o);if(r)customPlayerSecondary=e;else customPlayer=e}}